(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{1142:function(t,e,s){"use strict";s.r(e);var a=s(1143),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e.default=n.a},1143:function(t,e,s){"use strict";e.__esModule=!0;var a=f(s(28)),n=s(198),i=f(s(1548)),o=f(s(736)),r=f(s(740)),c=f(s(753)),l=f(s(752)),d=f(s(735)),u=f(s(1347));function f(t){return t&&t.__esModule?t:{default:t}}e.default={name:"task-instance-list-index",data:function(){return{isLoading:!0,total:null,taskInstanceList:[],searchParams:{pageSize:10,pageNo:1,searchVal:"",processInstanceId:"",host:"",stateType:"",startDate:"",endDate:"",executorName:""},isLeft:!0}},mixins:[c.default],props:{},methods:Object.assign({},(0,n.mapActions)("dag",["getTaskInstanceList"]),{_onQuery:function(t){this.searchParams=a.default.assign(this.searchParams,t),this.searchParams.processInstanceId="",this.searchParams.taskName&&(this.searchParams.taskName=""),this.searchParams.pageNo=1},_page:function(t){this.searchParams.pageNo=t},_pageSize:function(t){this.searchParams.pageSize=t},_getList:function(t){var e=this;if(this.isLoading=!t,null==this.searchParams.pageNo)return this.$router.push({path:"/projects/index"}),!1;this.getTaskInstanceList(this.searchParams).then((function(t){e.taskInstanceList=[],e.taskInstanceList=t.totalList,e.total=t.total,e.isLoading=!1})).catch((function(t){e.isLoading=!1}))},_debounceGET:a.default.debounce((function(t){0==sessionStorage.getItem("isLeft")?this.isLeft=!1:this.isLeft=!0,this._getList(t)}),100,{leading:!1,trailing:!0})}),watch:{$route:function(t){a.default.isEmpty(t.query)&&(this.searchParams.processInstanceId=""),this.searchParams.pageNo=a.default.isEmpty(t.query)?1:t.query.pageNo}},created:function(){},mounted:function(){var t=this;this.$modal.destroy(),this.setIntervalP=setInterval((function(){t._debounceGET("false")}),9e4)},beforeDestroy:function(){clearInterval(this.setIntervalP),sessionStorage.setItem("isLeft",1)},components:{mList:i.default,mInstanceConditions:u.default,mSpin:o.default,mListConstruction:d.default,mSecondaryMenu:l.default,mNoData:r.default}}},1144:function(t,e,s){"use strict";s.r(e);var a=s(1145),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e.default=n.a},1145:function(t,e,s){"use strict";e.__esModule=!0;var a=o(s(292)),n=o(s(898)),i=s(293);function o(t){return t&&t.__esModule?t:{default:t}}e.default={name:"list",data:function(){return{list:[],isAuth:a.default.getAuth(),backfillItem:{}}},props:{taskInstanceList:Array,pageNo:Number,pageSize:Number},methods:{_rtState:function(t){var e=i.tasksState[t];return'<em class="'+e.icoUnicode+" "+(e.isSpin?"as as-spin":"")+'" style="color:'+e.color+'" data-toggle="tooltip" data-container="body" title="'+e.desc+'"></em>'},_refreshLog:function(t){var e=this,s=this.$modal.dialog({closable:!1,showMask:!0,escClose:!0,className:"v-modal-custom",transitionName:"opacityp",render:function(a){return a(n.default,{on:{ok:function(){},close:function(){s.remove()}},props:{self:e,source:"list",logId:t.id}})}})},_go:function(t){this.$router.push({path:"/projects/instance/list/"+t.processInstanceId})}},watch:{taskInstanceList:function(t){var e=this;this.list=[],setTimeout((function(){e.list=t}))}},created:function(){},mounted:function(){this.list=this.taskInstanceList},components:{}}},1352:function(t,e,s){},1548:function(t,e,s){"use strict";s.r(e);var a=s(1673),n=s(1144);for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);var o=s(7),r=Object(o.a)(n.default,a.a,a.b,!1,null,null,null);e.default=r.exports},1549:function(t,e,s){"use strict";s(1352)},1619:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return n}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wrap-taskInstance"},[s("m-list-construction",{attrs:{title:t.$t("Task Instance")}},[s("template",{slot:"conditions"},[s("m-instance-conditions",{on:{"on-query":t._onQuery}})],1),t._v(" "),s("template",{slot:"content"},[t.taskInstanceList.length?[s("m-list",{attrs:{"task-instance-list":t.taskInstanceList,"page-no":t.searchParams.pageNo,"page-size":t.searchParams.pageSize}}),t._v(" "),s("div",{staticClass:"page-box"},[s("x-page",{attrs:{current:parseInt(t.searchParams.pageNo),total:t.total,"show-elevator":"","show-sizer":"","page-size-options":[10,30,50]},on:{"on-change":t._page,"on-size-change":t._pageSize}})],1)]:t._e(),t._v(" "),t.taskInstanceList.length?t._e():[s("m-no-data")],t._v(" "),s("m-spin",{attrs:{"is-spin":t.isLoading,"is-left":t.isLeft}})],2)],2)],1)},n=[]},1673:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return n}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list-model"},[s("div",{staticClass:"table-box"},[s("table",{staticClass:"fixed"},[s("tr",[s("th",{staticStyle:{"min-width":"50px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("#")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"200px","max-width":"300px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("Name")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"200px","max-width":"300px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("Process Instance")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"60px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("Executor")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"70px"},attrs:{scope:"col"}},[s("span",{staticStyle:{"margin-left":"5px"}},[t._v(t._s(t.$t("Node Type")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"30px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("State")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"130px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("Submit Time")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"130px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("Start Time")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"130px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("End Time")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"250px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("host")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"70px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("Duration")))])]),t._v(" "),s("th",{staticStyle:{"min-width":"60px"},attrs:{scope:"col"}},[s("div",{staticStyle:{width:"50px"}},[s("span",[t._v(t._s(t.$t("Retry Count")))])])]),t._v(" "),s("th",{staticStyle:{"min-width":"60px"},attrs:{scope:"col"}},[s("span",[t._v(t._s(t.$t("Operation")))])])]),t._v(" "),t._l(t.list,(function(e,a){return s("tr",{key:e.id},[s("td",[s("span",[t._v(t._s(parseInt(1===t.pageNo?a+1:a+1+t.pageSize*(t.pageNo-1))))])]),t._v(" "),s("td",{staticStyle:{"min-width":"200px","max-width":"300px","padding-right":"10px"}},[s("span",{staticClass:"ellipsis",attrs:{title:e.name}},[t._v(t._s(e.name))])]),t._v(" "),s("td",{staticStyle:{"min-width":"200px","max-width":"300px","padding-right":"10px"}},[s("a",{staticClass:"links",attrs:{href:"javascript:"},on:{click:function(s){return t._go(e)}}},[s("span",{staticClass:"ellipsis",attrs:{title:e.processInstanceName}},[t._v(t._s(e.processInstanceName))])])]),t._v(" "),s("td",[e.executorName?s("span",[t._v(t._s(e.executorName))]):s("span",[t._v("-")])]),t._v(" "),s("td",[s("span",{staticStyle:{"margin-left":"5px"}},[t._v(t._s(e.taskType))])]),t._v(" "),s("td",[s("span",{staticStyle:{cursor:"pointer"},domProps:{innerHTML:t._s(t._rtState(e.state))}})]),t._v(" "),s("td",[e.submitTime?s("span",[t._v(t._s(t._f("formatDate")(e.submitTime)))]):s("span",[t._v("-")])]),t._v(" "),s("td",[e.startTime?s("span",[t._v(t._s(t._f("formatDate")(e.startTime)))]):s("span",[t._v("-")])]),t._v(" "),s("td",[e.endTime?s("span",[t._v(t._s(t._f("formatDate")(e.endTime)))]):s("span",[t._v("-")])]),t._v(" "),s("td",{staticStyle:{"min-width":"250px"}},[s("span",{staticStyle:{"padding-right":"10px"}},[t._v(t._s(e.host||"-"))])]),t._v(" "),s("td",[s("span",[t._v(t._s(e.duration||"-"))])]),t._v(" "),s("td",[s("span",[t._v(t._s(e.retryTimes))])]),t._v(" "),s("td",[s("x-button",{attrs:{type:"info",shape:"circle",size:"xsmall","data-toggle":"tooltip",title:t.$t("View log"),icon:"ans-icon-log",disabled:"SUB_PROCESS"===e.taskType},on:{click:function(s){return t._refreshLog(e)}}})],1)])}))],2)])])},n=[]},685:function(t,e,s){"use strict";s.r(e);var a=s(1619),n=s(1142);for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);s(1549);var o=s(7),r=Object(o.a)(n.default,a.a,a.b,!1,null,null,null);e.default=r.exports},753:function(t,e,s){"use strict";e.__esModule=!0;var a,n=s(28),i=(a=n)&&a.__esModule?a:{default:a},o=s(751);e.default={watch:{searchParams:{deep:!0,handler:function(){(0,o.setUrlParams)(this.searchParams),this._debounceGET()}}},created:function(){i.default.isEmpty(this.$route.query)||(this.searchParams=i.default.assign(this.searchParams,this.$route.query))},mounted:function(){this._debounceGET()},methods:{_debounceGET:i.default.debounce((function(t){this._getList(t)}),100,{leading:!1,trailing:!0})}}},764:function(t,e,s){"use strict";(function(t){e.__esModule=!0,e.downloadFile=void 0;var a,n=s(20),i=(a=n)&&a.__esModule?a:{default:a},o=s(18);e.downloadFile=function(e,s){var a={url:(0,o.resolveURL)(e),obj:s};if(a.url){t('<form action="'+a.url+'" method="get">'+function(t){var e="";return Object.keys(t).forEach((function(s){e+="<input type='hidden' name = '"+s+"' value='"+t[s]+"'>"})),e}(a.obj)+"</form>").appendTo("body").submit().remove()}else(void 0).$message.warning(""+i.default.$t("Unable to download without proper url"))}}).call(this,s(17))},775:function(t,e,s){"use strict";s.r(e);var a=s(776),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e.default=n.a},776:function(t,e,s){"use strict";(function(t){e.__esModule=!0;var a=c(s(28)),n=c(s(20)),i=c(s(35)),o=c(s(291)),r=s(764);function c(t){return t&&t.__esModule?t:{default:t}}var l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t("body").find(".tooltip.fade.top.in").remove(),t(".textarea-ft").css({height:t(".content-log-box").height()-e+"px"})},d="";e.default={name:"log",data:function(){return{store:i.default,router:o.default,isLog:!1,stateId:t("#"+this.item.id).attr("data-state-id")||null,isScreen:!1,loadingIndex:0,isData:!0,loading:!1}},props:{item:{type:Object,default:{}},source:{type:String,default:"from"},logId:Number},methods:{_refreshLog:function(){var t=this;this.loading=!0,this.store.dispatch("dag/getLog",this._rtParam).then((function(e){setTimeout((function(){t.loading=!1,e.data?t.$message.success(""+n.default.$t("Update log success")):t.$message.warning(""+n.default.$t("No more logs"))}),1500),l().html("").text(e.data||""+n.default.$t("No log"))})).catch((function(e){t.$message.error(e.msg||""),t.loading=!1}))},_ckLog:function(){var e=this;this.isLog=!0,this.store.dispatch("dag/getLog",this._rtParam).then((function(s){e.$message.destroy(),s.data?(e.isData=!0,d=s.data,l().html("").text(d||""+n.default.$t("No log")),setTimeout((function(){t("#textarea").scrollTop(2)}),800)):(e.isData=!1,setTimeout((function(){e.$message.warning(""+n.default.$t("No more logs"))}),1e3),l().html("").text(d||""+n.default.$t("No log")))})).catch((function(t){e.$message.destroy(),e.$message.error(t.msg||"")}))},_screenOpen:function(){this.isScreen=!0;var e=t(".log-box"),s=t(window).width()-40,a=t(window).height()-40;e.css({width:s,height:a,marginLeft:"-"+parseInt(s/2)+"px",marginTop:"-"+parseInt(a/2)+"px"}),e.find(".content").animate({scrollTop:0},0),l().html("").text(d)},_screenClose:function(){this.isScreen=!1;var e=t(".log-box");e.attr("style",""),e.find(".content").animate({scrollTop:0},0),l().html("").text(d)},_downloadLog:function(){(0,r.downloadFile)("log/download-log",{taskInstanceId:this.stateId||this.logId})},_onUp:a.default.debounce((function(){this.loadingIndex=this.loadingIndex-1,this._ckLog()}),1e3,{leading:!1,trailing:!0}),_onDown:a.default.debounce((function(){this.loadingIndex=this.loadingIndex+1,this._ckLog()}),1e3,{leading:!1,trailing:!0}),_onTextareaScroll:function(){var e=this;t("#textarea-log").scroll((function(){var s=t(this);s.scrollTop()+s.height()===s.height()&&e.loadingIndex>0&&(e.$message.loading({content:""+n.default.$t("Loading Log..."),duration:0,closable:!1}),e._onUp()),s.get(0).scrollHeight===s.height()+s.scrollTop()&&e.isData&&(e.$message.loading({content:""+n.default.$t("Loading Log..."),duration:0,closable:!1}),e._onDown())}))},close:function(){t("body").find(".tooltip.fade.top.in").remove(),this.isScreen=!1,this.isLog=!1,d="",this.$emit("close")}},watch:{},created:function(){"list"===this.source&&(this.$message.loading({content:""+n.default.$t("Loading Log..."),duration:0,closable:!1}),this._ckLog())},mounted:function(){this._onTextareaScroll()},updated:function(){},computed:{_rtParam:function(){return{taskInstanceId:this.stateId||this.logId,skipLineNum:parseInt(""+(this.loadingIndex?this.loadingIndex+"000":0)),limit:parseInt((this.loadingIndex?this.loadingIndex+1:1)+"000")}}},components:{}}}).call(this,s(17))},805:function(t,e,s){},898:function(t,e,s){"use strict";s.r(e);var a=s(921),n=s(775);for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);s(899);var o=s(7),r=Object(o.a)(n.default,a.a,a.b,!1,null,null,null);e.default=r.exports},899:function(t,e,s){"use strict";s(805)},921:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return n}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"log-model"},[t.stateId&&"SUB_PROCESS"!==t.item.type?s("span",[t._t("history"),t._v(" "),s("span",{on:{click:t._ckLog}},[t._t("log")],2)],2):t._e(),t._v(" "),s("transition",{attrs:{name:"fade"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isLog||"list"===t.source,expression:"isLog || source === 'list'"}],staticClass:"log-pop"},[s("div",{staticClass:"log-box"},[s("div",{staticClass:"title"},[s("span",[t._v(t._s(t.$t("View log")))]),t._v(" "),s("div",{staticClass:"full-screen"},[s("a",{attrs:{href:"javascript:","data-container":"body","data-toggle":"tooltip",title:t.$t("Download Log")},on:{click:t._downloadLog}},[s("em",{staticClass:"ans-icon-download",staticStyle:{"font-size":"20px"}})]),t._v(" "),s("a",{staticClass:"refresh-log",class:t.loading?"active":"",attrs:{href:"javascript:","data-container":"body","data-toggle":"tooltip",title:t.$t("Refresh Log")},on:{click:function(e){!t.loading&&t._refreshLog()}}},[s("em",{staticClass:"ans-icon-refresh"})]),t._v(" "),s("a",{directives:[{name:"show",rawName:"v-show",value:!t.isScreen,expression:"!isScreen"}],attrs:{href:"javascript:","data-container":"body","data-toggle":"tooltip",title:t.$t("Enter full screen")},on:{click:t._screenOpen}},[s("em",{staticClass:"ans-icon-max"})]),t._v(" "),s("a",{directives:[{name:"show",rawName:"v-show",value:t.isScreen,expression:"isScreen"}],attrs:{href:"javascript:","data-container":"body","data-toggle":"tooltip",title:t.$t("Cancel full screen")},on:{click:t._screenClose}},[s("em",{staticClass:"ans-icon-min"})])])]),t._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"content-log-box"},[s("textarea",{staticClass:"textarea-ft",staticStyle:{width:"100%"},attrs:{id:"textarea-log",spellcheck:"false"}})])]),t._v(" "),s("div",{staticClass:"operation"},[s("x-button",{attrs:{type:"primary",shape:"circle"},on:{click:t.close}},[t._v(" "+t._s(t.$t("Close"))+" ")])],1)])])])],1)},n=[]}}]);